(function (c, l, a, r, i, t, y) {
    c[a] =
        c[a] ||
        function () {
            (c[a].q = c[a].q || []).push(arguments);
        };
    t = l.createElement(r);
    t.async = 1;
    t.src = "https://www.clarity.ms/tag/" + i;
    y = l.getElementsByTagName(r)[0];
    y.parentNode.insertBefore(t, y);
})(window, document, "clarity", "script", "qtvqid4vik");


/**
 * 书籍页面JavaScript文件
 * 主要功能：
 * 1. 主题切换功能
 * 2. 书籍弹窗交互
 * 3. 书籍内容加载和阅读位置记忆
 */

// 初始化Clarity分析工具
const toggleSwitch = document.getElementById("theme-toggle");

/**
 * 检测系统是否为深色模式
 * @type {boolean}
 */
const prefersDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches;

// 根据系统偏好设置初始主题
if (prefersDarkMode) {
    document.body.classList.remove("light");
    document.body.classList.add("dark");
    toggleSwitch.checked = true;

    // 初始化弹窗颜色为深色
    const modal = document.querySelector('.modal-content');
    modal.style.backgroundColor = '#333';
    modal.style.color = '#fff';
}

/**
 * 添加书籍点击事件
 * 点击书籍项时显示弹窗并加载对应书籍内容
 */
document.querySelectorAll('.book-item').forEach((item, index) => {
    item.style.cursor = 'pointer'; // 设置鼠标指针样式

    item.addEventListener('click', function () {
        const modal = document.querySelector('.book-modal');
        modal.style.display = 'block';

        // 延迟添加show类以实现动画效果
        setTimeout(() => {
            modal.classList.add('show');
        }, 10);

        // 根据点击的书籍索引加载对应内容
        if (index === 0) {
            loadBookContent('kongyiji'); // 加载孔乙己内容
        } else {
            loadBookContent('daocaoren'); // 加载稻草人内容
        }
    });
});

// 关闭弹窗事件
document.querySelector('.close-modal').addEventListener('click', function () {
    const modal = document.querySelector('.book-modal');
    modal.classList.remove('show');

    // 延迟隐藏弹窗以实现淡出动画
    setTimeout(() => {
        modal.style.display = 'none';
    }, 300);
});

/**
 * 主题切换事件监听
 * 切换深色/浅色主题并更新相关元素样式
 */
toggleSwitch.addEventListener("change", () => {
    document.body.classList.toggle("dark");
    document.body.classList.toggle("light");

    // 更新弹窗和书籍介绍的颜色主题
    updateThemeColors();
});

/**
 * 加载书籍内容函数
 * @param {string} bookId - 书籍ID (kongyiji或daocaoren)
 */
function loadBookContent(bookId) {
    const tocList = document.querySelector('.toc-list'); // 目录列表
    const contentText = document.querySelector('.content-text'); // 内容区域

    // 清空现有内容
    tocList.innerHTML = '';
    contentText.innerHTML = '';

    /**
     * 书籍内容数据
     * @type {Object}
     * @property {Array} chapters - 章节标题数组
     * @property {Array} contents - 章节内容数组
     */
    const booksData = {
        kongyiji: {
            chapters: ["孔乙己", "准风月谈", "推"],
            contents: [
                "鲁镇的酒店的格局，是和别处不同的：都是当街一个曲尺形的大柜台，柜里面预备着热水，可以随时温酒。做工的人，傍午傍晚散了工，每每花四文铜钱，买一碗酒，——这是二十多年前的事，现在每碗要涨到十文，——靠柜外站着，热热的喝了休息；倘肯多花一文，便可以买一碟盐煮笋，或者茴香豆，做下酒物了，如果出到十几文，那就能买一样荤菜，但这些顾客，多是短衣帮，大抵没有这样阔绰。只有穿长衫的，才踱进店面隔壁的房子里，要酒要菜，慢慢地坐喝。我从十二岁起，便在镇口的咸亨酒店里当伙计，掌柜说，样子太傻，怕侍候不了长衫主顾，就在外面做点事罢。外面的短衣主顾，虽然容易说话，但唠唠叨叨缠夹不清的也很不少。他们往往要亲眼看着黄酒从坛子里舀出，看过壶子底里有水没有，又亲看将壶子放在热水里，然后放心：在这严重监督之下，羼水也很为难。所以过了几天，掌柜又说我干不了这事。幸亏荐头的情面大，辞退不得，便改为专管温酒的一种无聊职务了。我从此便整天的站在柜台里，专管我的职务。虽然没有什么失职，但总觉有些单调，有些无聊。掌柜是一副凶脸孔，主顾也没有好声气，教人活泼不得；只有孔乙己到店，才可以笑几声，所以至今还记得。孔乙己是站着喝酒而穿长衫的唯一的人。他身材很高大；青白脸色，皱纹间时常夹些伤痕；一部乱蓬蓬的花白的胡子。穿的虽然是长衫，可是又脏又破，似乎十多年没有补，也没有洗。他对人说话，总是满口之乎者也，教人半懂不懂的。因为他姓孔，别人便从描红纸上的“上大人孔乙己”这半懂不懂的话里，替他取下一个绰号，叫作孔乙己。孔乙己一到店，所有喝酒的人便都看着他笑，有的叫道，​“孔乙己，你脸上又添上新伤疤了！”他不回答，对柜里说，​“温两碗酒，要一碟茴香豆。​”便排出九文大钱。他们又故意的高声嚷道，​“你一定又偷了人家的东西了！”孔乙己睁大眼睛说，​“你怎么这样凭空污人清白……”​“什么清白？我前天亲眼见你偷了何家的书，吊着打。​”孔乙己便涨红了脸，额上的青筋条条绽出，争辩道，​“窃书不能算偷……窃书！……读书人的事，能算偷么？​”接连便是难懂的话，什么“君子固穷”​，什么“者乎”之类，引得众人都哄笑起来：店内外充满了快活的空气。听人家背地里谈论，孔乙己原来也读过书，但终于没有进学[插图]，又不会营生；于是愈过愈穷，弄到将要讨饭了。幸而写得一笔好字，便替人家抄抄书，换一碗饭吃。可惜他又有一样坏脾气，便是好喝懒做。坐不到几天，便连人和书籍纸张笔砚，一齐失踪。如是几次，叫他抄书的人也没有了。孔乙己没有法，便免不了偶然做些偷窃的事。但他在我们店里，品行却比别人都好，就是从不拖欠；虽然间或没有现钱，暂时记在粉板上，但不出一月，定然还清，从粉板上拭去了孔乙己的名字。孔乙己喝过半碗酒，涨红的脸色渐渐复了原，旁人便又问道，​“孔乙己，你当真认识字么？​”孔乙己看着问他的人，显出不屑置辩的神气。他们便接着说道，​“你怎的连半个秀才也捞不到呢？​”孔乙己立刻显出颓唐不安模样，脸上笼上了一层灰色，嘴里说些话；这回可是全是之乎者也之类，一些不懂了。在这时候，众人也都哄笑起来：店内外充满了快活的空气。在这些时候，我可以附和着笑，掌柜是决不责备的。而且掌柜见了孔乙己，也每每这样问他，引人发笑。孔乙己自己知道不能和他们谈天，便只好向孩子说话。有一回对我说道，​“你读过书么？​”我略略点一点头。他说，​“读过书，……我便考你一考。茴香豆的茴字，怎样写的？​”我想，讨饭一样的人，也配考我么？便回过脸去，不再理会。孔乙己等了许久，很恳切地说道，​“不能写罢？……我教给你，记着！这些字应该记着。将来做掌柜的时候，写账要用。​”我暗想我和掌柜的等级还很远呢，而且我们掌柜也从不将茴香豆上账；又好笑，又不耐烦，懒懒地答他道，​“谁要你教，不是草头底下一个来回的回字么？​”孔乙己显出极高兴的样子，将两个指头的长指甲敲着柜台，点头说，​“对呀对呀！……回字有四样写法，你知道么？​”我愈不耐烦了，努着嘴走远。孔乙己刚用指甲蘸了酒，想在柜上写字，见我毫不热心，便又叹一口气，显出极惋惜的样子。有几回，邻舍孩子听得笑声，也赶热闹，围住了孔乙己，他便给他们茴香豆吃，一人一颗。孩子吃完豆，仍然不散，眼睛都望着碟子。孔乙己着了慌，伸开五指将碟子罩住，弯腰下去说道，​“不多了，我已经不多了。​”直起身又看一看豆，自己摇头说，​“不多不多！多乎哉？不多也。​”于是这一群孩子都在笑声里走散了。孔乙己是这样的使人快活，可是没有他，别人也便这么过。有一天，大约是中秋前的两三天，掌柜正在慢慢的结账，取下粉板，忽然说，​“孔乙己长久没有来了。还欠十九个钱呢！”我才也觉得他的确长久没有来了。一个喝酒的人说道，​“他怎么会来？……他打折了腿了。​”掌柜说，​“哦！”​“他总仍旧是偷。这一回，是自己发昏，竟偷到丁举人家里去了。他家的东西，偷得的么？​”​“后来怎么样？​”​“怎么样？先写服辩[插图]，后来是打，打了大半夜，再打折了腿。​”​“后来呢？​”​“后来打折了腿了。​”​“打折了怎样呢？​”​“怎样？……谁晓得？许是死了。​”掌柜也不再问，仍然慢慢地算他的账。中秋过后，秋风是一天凉比一天，看看将近初冬；我整天的靠着火，也须穿上棉袄了。一天的下半天，没有一个顾客，我正合了眼坐着。忽然间听得一个声音，​“温一碗酒。​”这声音虽然极低，却很耳熟。看时又全没有人。站起来向外一望，那孔乙己便在柜台下对了门槛坐着。他脸上黑而且瘦，已经不成样子；穿一件破夹袄，盘着两腿，下面垫一个蒲包，用草绳在肩上挂住；见了我，又说道，​“温一碗酒。​”掌柜也伸出头去，一面说，​“孔乙己么？你还欠十九个钱呢！”孔乙己很颓唐的仰面答道，​“这……下回还清罢。这一回是现钱，酒要好。​”掌柜仍然同平常一样，笑着对他说，​“孔乙己，你又偷了东西了！”但他这回却不十分分辩，单说了一句“不要取笑！”​“取笑？要是不偷，怎么会打断腿？​”孔乙己低声说道，​“跌断，跌，跌……”他的眼色，很像恳求掌柜，不要再提。此时已经聚集了几个人，便和掌柜都笑了。我温了酒，端出去，放在门槛上。他从破衣袋里摸出四文大钱，放在我手里，见他满手是泥，原来他便用这手走来的。不一会，他喝完酒，便又在旁人的说笑声中，坐着用这手慢慢走去了。自此以后，又长久没有看见孔乙己。到了年关，掌柜取下粉板说，​“孔乙己还欠十九个钱呢！”到第二年的端午，又说“孔乙己还欠十九个钱呢！”到中秋可是没有说，再到年关也没有看见他。我到现在终于没有见——大约孔乙己的确死了。",
                "自从中华民国建国二十有二年五月二十五日《自由谈》的编者刊出了“吁请海内文豪，从兹多谈风月”的启事以来，很使老牌风月文豪摇头晃脑的高兴了一大阵，讲冷话的也有，说俏皮话的也有，连只会做“文探”的巴儿们也翘起了它尊贵的尾巴。但有趣的是谈风云的人，风月也谈得，谈风月就谈风月罢，虽然仍旧不能正如尊意。想从一个题目限制了作家，其实是不能够的。假如出一个“学而时习之”的试题，叫遗少和车夫来做八股，那做法就决定不一样。自然，车夫做的文章可以说是不通，是胡说，但这不通或胡说，就打破了遗少们的一统天下。古话里也有过：柳下惠看见糖水，说“可以养老”​，盗跖见了，却道可以粘门闩。他们是弟兄，所见的又是同一的东西，想到的用法却有这么天差地远。​“月白风清，如此良夜何？​”好的，风雅之至，举手赞成。但同是涉及风月的“月黑杀人夜，风高放火天”呢，这不明明是一联古诗么？我的谈风月也终于谈出了乱子来，不过也并非为了主张“杀人放火”​。其实，以为“多谈风月”​，就是“莫谈国事”的意思，是误解的。​“漫谈国事”倒并不要紧，只是要“漫”​，发出去的箭石，不要正中了有些人物的鼻梁，因为这是他的武器，也是他的幌子。从六月起的投稿，我就用种种的笔名了，一面固然为了省事，一面也省得有人骂读者们不管文字，只看作者的署名。然而这么一来，却又使一些看文字不用视觉，专靠嗅觉的“文学家”疑神疑鬼，而他们的嗅觉又没有和全体一同进化，至于看见一个新的作家的名字，就疑心是我的化名，对我呜呜不已，有时简直连读者都被他们闹得莫名其妙了。现在就将当时所用的笔名，仍旧留在每篇之下，算是负着应负的责任。还有一点和先前的编法不同的，是将刊登时被删改的文字大概补上去了，而且旁加黑点，以清眉目。这删改，是出于编辑或总编辑，还是出于官派的检查员的呢，现在已经无从辨别，但推想起来，改点句子，去些讳忌，文章却还能连接的处所，大约是出于编辑的，而胡乱删削，不管文气的接不接，语意的完不完的，便是钦定的文章。日本的刊物，也有禁忌，但被删之处，是留着空白，或加虚线，使读者能够知道的。中国的检查官却不许留空白，必须接起来，于是读者就看不见检查删削的痕迹，一切含糊和恍惚之点，都归在作者身上了。这一种办法，是比日本大有进步的，我现在提出来，以存中国文网史上极有价值的故实。去年的整半年中，随时写一点，居然在不知不觉中又成一本了。当然，这不过是一些拉杂的文章，为“文学家”所不屑道。然而这样的文字，现在却也并不多，而且“拾荒”的人们，也还能从中检出东西来，我因此相信这书的暂时的生存，并且作为集印的缘故。",
                "两三月前，报上好像登过一条新闻，说有一个卖报的孩子，踏上电车的踏脚去取报钱，误踹住了一个下来的客人的衣角，那人大怒，用力一推，孩子跌入车下，电车又刚刚走动，一时停不住，把孩子碾死了。推倒孩子的人，却早已不知所往。但衣角会被踹住，可见穿的是长衫，即使不是“高等华人”​，总该是属于上等的。我们在上海路上走，时常会遇见两种横冲直撞，对于对面或前面的行人，决不稍让的人物。一种是不用两手，却只将直直的长脚，如入无人之境似的踏过来，倘不让开，他就会踏在你的肚子或肩膀上。这是洋大人，都是“高等”的，没有华人那样上下的区别。一种就是弯上他两条臂膊，手掌向外，像蝎子的两个钳一样，一路推过去，不管被推的人是跌在泥塘或火坑里。这就是我们的同胞，然而“上等”的，他坐电车，要坐二等所改的三等车，他看报，要看专登黑幕的小报，他坐着看得咽唾沫，但一走动，又是推。上车，进门，买票，寄信，他推；出门，下车，避祸，逃难，他又推。推得女人孩子都踉踉跄跄，跌倒了，他就从活人上踏过，跌死了，他就从死尸上踏过，走出外面，用舌头舔舔自己的厚嘴唇，什么也不觉得。旧历端午，在一家戏场里，因为一句失火的谣言，就又是推，把十多个力量未足的少年踏死了。死尸摆在空地上，据说去看的又有万余人，人山人海，又是推。推了的结果，是嘻开嘴巴，说道：​“阿唷，好白相来希呀！”住在上海，想不遇到推与踏，是不能的，而且这推与踏也还要廓大开去。要推倒一切下等华人中的幼弱者，要踏倒一切下等华人。这时就只剩了高等华人颂祝着——“阿唷，真好白相来希呀。为保全文化起见，是虽然牺牲任何物质，也不应该顾惜的——这些物质有什么重要性呢！”"
            ]
        },
        daocaoren: {
            chapters: [
                "稻草人"
            ],
            contents: [
                "田野里白天的风景和情形，有诗人把它写成美妙的诗，有画家把它画成生动的画。到了夜间，诗人喝了酒，有些醉了；画家呢，正在抱着精致的乐器低低地唱：都没有工夫到田野里来。那么，还有谁把田野里夜间的风景和情形告诉人们呢？有，还有，就是稻草人。基督教里的人说，人是上帝亲手造的。且不问这句话对不对，咱们可以套一句说，稻草人是农人亲手造的。他的骨架子是竹园里的细竹枝，他的肌肉、皮肤是隔年的黄稻草。破竹篮子、残荷叶都可以做他的帽子；帽子下面的脸平板板的，分不清哪里是鼻子，哪里是眼睛。他的手没有手指，却拿着一把破扇子——其实也不能算拿，不过用线拴住扇柄，挂在手上罢了。他的骨架子长得很，脚底下还有一段，农人把这一段插在田地中间的泥土里，他就整天整夜站在那里了。稻草人非常尽责任。要是拿牛跟他比，牛比他懒怠多了，有时躺在地上，抬起头看天。要是拿狗跟他比，狗比他顽皮多了，有时到处乱跑，累得主人四外去找寻。他从来不嫌烦，像牛那样躺着看天；也从来不贪玩，像狗那样到处乱跑。他安安静静地看着田地，手里的扇子轻轻摇动，赶走那些飞来的小雀，他们是来吃新结的稻穗的。他不吃饭，也不睡觉，就是坐下歇一歇也不肯，总是直挺挺地站在那里。这是当然的，田野里夜间的风景和情形，只有稻草人知道得最清楚，也知道得最多。他知道露水怎么样凝在草叶上，露水的味道怎么样香甜；他知道星星怎么样眨眼，月亮怎么样笑；他知道夜间的田野怎么样沉静，花草树木怎么样酣睡；他知道小虫们怎么样你找我、我找你，蝴蝶们怎么样恋爱，总之，夜间的一切他都知道得清清楚楚。以下就讲讲稻草人在夜间遇见的几件事儿。一个满天星斗的夜里，他看守着田地，手里的扇子轻轻摇动。新出的稻穗一个挨一个，星光射在上面，有些发亮，像顶着一层水珠，有一点儿风，就沙拉沙拉地响。稻草人看着，心里很高兴。他想，今年的收成一定可以使他的主人——一位可怜的老太太——笑一笑了。她以前哪里笑过呢？八九年前，她的丈夫死了。她想起来就哭，眼睛到现在还红着；而且成了毛病，动不动就流泪。她只有一个儿子，娘儿两个费苦力种这块田，足足有三年，才勉强把她丈夫的丧葬费还清。没想到儿子紧接着得了白喉，也死了。她当时昏过去了，后来就落了个心痛的毛病，常常犯。这回只剩她一个人了，老了，没有气力，还得用力耕种，又挨了三年，总算把儿子的丧葬费也还清了。可是接着两年闹水，稻子都淹了，不是烂了就是发了芽。她的眼泪流得更多了，眼睛受了伤，看东西模糊，稍微远一点儿就看不见。她的脸上满是皱纹，倒像个风干的橘子，哪里会露出笑容来呢！可是今年的稻子长得好，很壮实，雨水又不多，像是能丰收似的。所以稻草人替她高兴：想到收割的那一天，她看见收下的稻穗又大又饱满，这都是她自己的，总算没有白受累，脸上的皱纹一定会散开，露出安慰的满意的笑容吧。如果真有这一笑，在稻草人看来，那就比星星月亮的笑更可爱，更可珍贵，因为他爱他的主人。稻草人正在想的时候，一个小蛾飞来，是灰褐色的小蛾。他立刻认出那小蛾是稻子的仇敌，也就是主人的仇敌。从他的职务想，从他对主人的感情想，都必须把那小蛾赶跑了才是。于是他手里的扇子摇动起来。可是扇子的风很有限，不能够教小蛾害怕。那小蛾飞了一会儿，落在一片稻叶上，简直像不觉得稻草人在那里驱逐他似的。稻草人见小蛾落下了，心里非常着急。可是他的身子跟树木一样，定在泥土里，想往前移动半步也做不到；扇子尽管摇动，那小蛾却依旧稳稳地歇着。他想到将来田里的情形，想到主人的眼泪和干瘪的脸，又想到主人的命运，心里就像刀割一样。但是那小蛾是歇定了，不管怎么赶，他就是不动。星星结队归去，一切夜景都隐没的时候，那小蛾才飞走了。稻草人仔细看那片稻叶，果然，叶尖卷起来了，上面留着好些小蛾下的子。这使稻草人感到无限惊恐，心想祸事真个来了，越怕越躲不过。可怜的主人，她有的不过是两只模糊的眼睛；要告诉她，使她及早看见小蛾下的子，才有挽救呢。他这么想着，扇子摇得更勤了。扇子常常碰在身体上，发出啪啪的声音。他不会叫喊，这是惟一的警告主人的法子了。老妇人到田里来了。她弯着腰，看看田里的水正合适，不必再从河里车水进来。又看看她手种的稻子，全很壮实；摸摸稻穗，沉甸甸的。再看看那稻草人，帽子依旧戴得很正；扇子依旧拿在手里，摇动着，发出啪啪的声音；并且依旧站得很好，直挺挺的，位置没有动，样子也跟以前一模一样。她看一切事情都很好，就走上田岸，预备回家去搓草绳。稻草人看见主人就要走了，急得不得了，连忙摇动扇子，想靠着这急迫的声音把主人留住。这声音里仿佛说：​“我的主人，你不要去呀！你不要以为田里的一切事情都很好，天大的祸事已经在田里留下根苗了。一旦发作起来，就要不可收拾，那时候，你就要流干了眼泪，揉碎了心；趁着现在赶早扑灭，还来得及。这儿，就在这一棵上，你看这棵稻子的叶尖呀！”他靠着扇子的声音反复地警告；可是老妇人哪里懂得，一步一步地走远了。他急得要命，还在使劲摇动扇子，直到主人的背影都望不见了，他才知道警告是无效了。除了稻草人以外，没有一个人为稻子发愁。他恨不得一下子跳过去，把那灾害的根苗扑灭了；又恨不得托风带个信，叫主人快快来铲除灾害。他的身体本来很瘦弱，现在怀着愁闷，更显得憔悴了，连站直的劲儿也不再有，只是斜着肩，弯着腰，好像害了病似的。不到几天，在稻田里，蛾下的子变成的肉虫，到处都是了。夜深人静的时候，稻草人听见他们咬嚼稻叶的声音，也看见他们越吃越馋的嘴脸。渐渐地，一大片浓绿的稻全不见了，只剩下光秆儿。他痛心，不忍再看，想到主人今年的辛苦又只能换来眼泪和叹气，禁不住低头哭了。这时候天气很凉了，又是在夜间的田野里，冷风吹得稻草人直打哆嗦；只因为他正在哭，没觉得。忽然传来一个女人的声音：​“我当是谁呢，原来是你。​”他吃了一惊，才觉得身上非常冷。但是有什么法子呢？他为了尽责任，而且行动不由自主，虽然冷，也只好站在那里。他看那个女人，原来是一个渔妇。田地的前面是一条河，那渔妇的船就停在河边，舱里露出一丝微弱的火光。她那时正在把撑起的鱼罾放到河底；鱼罾沉下去，她坐在岸上，等过一会儿把它拉起来。舱里时常传出小孩子咳嗽的声音，又时常传出困乏的、细微的叫妈的声音。这使她很焦心，她用力拉罾，总像很不顺手，并且几乎回回是空的。舱里的孩子还在咳嗽还在喊，她就向舱里说：​“你好好儿睡吧！等我得着鱼，明天给你煮粥吃。你老是叫我，叫得我心都乱了，怎么能得着鱼呢！”孩子忍不住，还是喊：​“妈呀，把我渴坏了！给我点儿茶喝！”接着又是一阵咳嗽。“这里哪来的茶！你老实一会儿吧，我的祖宗！”“我渴死了！”孩子竟大声哭起来。在空旷的夜间的田野里，这哭声显得格外凄惨。渔妇无可奈何，放下拉罾的绳子，上了船，进了舱，拿起一个碗，从河里舀了一碗水，转身给孩子喝。孩子一口气把水喝下去，他实在渴极了。可是碗刚放下，他又咳嗽起来；而且更厉害了，后来就只剩下喘气。渔妇不能多管孩子，又上岸去拉她的罾。好久好久，舱里没有声音了，她的罾也不知又空了几回，才得着一条鲫鱼，有七八寸长。这是头一次收获，她很小心地把鱼从罾里取出来，放在一个木桶里，接着又把罾放下去。这个盛鱼的木桶就在稻草人的脚旁边。这时候稻草人更加伤心了。他可怜那个病孩子，渴到那样，想一口茶喝都办不到；病到那样，还不能跟母亲一起睡觉。他又可怜那个渔妇，在这寒冷的深夜里打算明天的粥，所以不得不硬着心肠把生病的孩子扔下不管。他恨不得自己去作柴，给孩子煮茶喝；恨不得自己去作被褥，给孩子一些温暖；又恨不得夺下小肉虫的赃物，给渔妇煮粥吃。如果他能走，他一定立刻照着他的心愿做；但是不幸，他的身体跟树木一个样，定在泥土里，连半步也不能动。他没有法子，越想越伤心，哭得更痛心了。忽然啪的一声，他吓了一跳，停住哭，看出了什么事情，原来是鲫鱼被扔在木桶里。木桶里的水很少，鲫鱼躺在桶底上，只有靠下的一面能够沾一些潮润。鲫鱼很难受，想逃开，就用力向上跳。跳了好几回，都被高高的桶框挡住，依旧掉在桶底上，身体摔得很疼。鲫鱼向上的一只眼睛看见稻草人，就哀求说：​“我的朋友，你暂且放下手里的扇子，救救我吧！我离开我的水里的家，就只有死了。好心的朋友，救救我吧！”听见鲫鱼这样恳切的哀求，稻草人非常心酸；但是他只能用力摇动自己的头。他的意思是说：​“请你原谅我，我是个柔弱无能的人哪！我的心不但愿意救你，并且愿意救那个捕你的妇人和她的孩子，除了你、渔妇和孩子，还有一切受苦受难的。可是我跟树木一样，定在泥土里，连半步也不能自由移动，我怎么能照我的心愿去做呢！请你原谅我，我是个柔弱无能的人哪！”鲫鱼不懂稻草人的意思，只看见他连连摇头，愤怒就像火一般地烧起来了。​“这又是什么难事！你竟没有一点儿人心，只是摇头！原来我错了，自己的困难，为什么求别人呢！我应该自己干，想法子，不成，也不过一死罢了，这又算得了什么！”鲫鱼大声喊着，又用力向上跳，这回用了十二分力，连尾巴和胸鳍的尖端都挺了起来。稻草人见鲫鱼误解了他的意思，又没有方法向鲫鱼说明，心里很悲痛，就一面叹气一面哭。过了一会儿，他抬头看看，渔妇睡着了，一只手还拿着拉罾的绳；这是因为她太累了，虽然想着明天的粥，也终于支持不住了。桶里的鲫鱼呢？跳跃的声音听不见了，尾巴好像还在断断续续地拨动。稻草人想，这一夜是许多痛心的事都凑在一块儿了，真是个悲哀的夜！可是看那些吃稻叶的小强盗，他们高兴得很，吃饱了，正在光秆儿上跳舞呢。稻子的收成算完了，主人的衰老的力量又白费了，世界上还有比这更可怜的吗！夜更暗了，连星星都显得无光。稻草人忽然觉得由侧面田岸上走来一个黑影，近了，仔细一看，原来是个女人，穿着肥大的短袄，头发很乱。她站住，望望停在河边的渔船；一转身，向着河岸走去；不多几步，又直挺挺地站在那里。稻草人觉得很奇怪，就留心看着她。一种非常悲伤的声音从她的嘴里发出来，微弱，断断续续，只有听惯了夜间一切细小声音的稻草人才听得出。那声音说：​“我不是一条牛，也不是一口猪，怎么能让你随便卖给人家！我要跑，不能等着明天真个被你卖给人家。你有一点儿钱，不是赌两场输了就是喝几天黄汤花了，管什么用！你为什么一定要逼我？……只有死，除了死没有别的路！死了，到地下找我的孩子去吧！”这些话又哪里成话呢，哭得抽抽搭搭的，声音都被搅乱了。稻草人非常心惊，又是一件惨痛的事情让他遇见了。她要寻死呢！他着急，想救她，自己也不知道为什么。他又摇起扇子来，想叫醒那个沉睡的渔妇。但是办不到，那渔妇睡得跟死了似的，一动也不动。他恨自己，不该像树木一样定在泥土里，连半步也不能动。见死不救不是罪恶吗？自己就正在犯着这种罪恶。这真是比死还难受的痛苦哇！“天哪，快亮吧！农人们快起来吧！鸟儿快飞去报信吧！风快吹散她寻死的念头吧！”他这样默默地祈祷；可是四围还是黑洞洞的，也没有一丝儿声音。他心碎了，怕看又不能不看，就胆怯地死盯着站在河边的黑影。那女人沉默着站了一会儿，身子往前探了几探。稻草人知道可怕的时候到了，手里的扇子拍得更响。可是她并没跳，又直挺挺地站在那里。又过了好大一会儿，她忽然举起胳膊，身体像倒下一样，向河里蹿去。稻草人看见这样，没等到听见她掉在水里的声音，就昏过去了。第二天早晨，农人从河岸经过，发现河里有死尸，消息立刻传出去。左近的男男女女都跑来看。嘈杂的人声惊醒了酣睡的渔妇，她看那木桶里的鲫鱼，已经僵僵地死了。她提了木桶走回船舱；生病的孩子醒了，脸显得更瘦了，咳嗽也更加厉害。那老农妇也随着大家到河边来看；走过自己的稻田，顺便看了一眼。没想到才几天工夫，完了，稻叶稻穗都没有了，只留下直僵僵的光秆儿。她急得跺脚，捶胸，放声大哭。大家跑过来问她劝她，看见稻草人倒在田地中间。"
            ]
        }
    };

    const book = booksData[bookId];
    let currentSelectedItem = null; // 当前选中的章节项

    if (book) {
        // 从本地存储获取上次阅读位置
        const lastReadKey = `lastRead_${bookId}`;
        let lastChapterIndex = localStorage.getItem(lastReadKey);
        lastChapterIndex = lastChapterIndex ? parseInt(lastChapterIndex) : 0;

        // 生成目录列表
        book.chapters.forEach((chapter, index) => {
            const li = document.createElement('li');
            li.textContent = chapter;

            // 章节点击事件
            li.addEventListener('click', () => {
                // 显示章节内容
                contentText.innerHTML = `<p>${book.contents[index]}</p>`;

                // 更新选中项样式
                updateSelectedChapterStyle(li, currentSelectedItem);
                currentSelectedItem = li;

                // 保存阅读位置
                localStorage.setItem(lastReadKey, index);
            });

            tocList.appendChild(li);
        });

        // 显示上次阅读的章节或第一章
        showLastReadChapter(tocList, contentText, book, lastChapterIndex);
    }
}

/**
 * 更新主题颜色
 */
function updateThemeColors() {
    const modal = document.querySelector('.modal-content');

    if (document.body.classList.contains('dark')) {
        // 深色模式样式
        modal.style.backgroundColor = '#333';
        modal.style.color = '#fff';

        // 更新书籍介绍颜色
        document.querySelectorAll('.book-description').forEach(desc => {
            desc.style.color = '#e0e0e0';
        });
        document.querySelectorAll('.book-item h3, .book-item p').forEach(text => {
            text.style.color = '#ffffff';
        });
    } else {
        // 浅色模式样式
        modal.style.backgroundColor = '';
        modal.style.color = '';

        // 恢复默认颜色
        document.querySelectorAll('.book-description').forEach(desc => {
            desc.style.color = '';
        });
        document.querySelectorAll('.book-item h3, .book-item p').forEach(text => {
            text.style.color = '';
        });
    }
}

/**
 * 更新选中章节样式
 * @param {HTMLElement} newItem - 新选中的章节项
 * @param {HTMLElement|null} currentItem - 当前选中的章节项
 */
function updateSelectedChapterStyle(newItem, currentItem) {
    if (currentItem) {
        currentItem.style.color = '';
        currentItem.style.fontWeight = '';
    }
    newItem.style.color = '#0066cc';
    newItem.style.fontWeight = 'bold';
}

/**
 * 显示上次阅读的章节
 * @param {HTMLElement} tocList - 目录列表元素
 * @param {HTMLElement} contentText - 内容区域元素
 * @param {Object} book - 书籍数据对象
 * @param {number} chapterIndex - 章节索引
 */
function showLastReadChapter(tocList, contentText, book, chapterIndex) {
    const showIndex = Math.min(chapterIndex, book.chapters.length - 1);
    if (book.chapters.length > 0) {
        contentText.innerHTML = `<p>${book.contents[showIndex]}</p>`;
        const selectedItem = tocList.children[showIndex];
        if (selectedItem) {
            selectedItem.style.color = '#0066cc';
            selectedItem.style.fontWeight = 'bold';
        }
    }
}
document.getElementById('toggle-toc').addEventListener('click', function () {
    const toc = document.querySelector('.modal-toc');
    const content = document.querySelector('.modal-content-text');
    const btn = document.getElementById('toggle-toc');

    // 添加动画类
    toc.classList.add('animating');
    content.classList.add('animating');

    // 切换显示状态
    toc.classList.toggle('hidden');
    content.classList.toggle('full-width');

    // 更新按钮文本
    btn.textContent = toc.classList.contains('hidden') ? '显示目录' : '隐藏目录';

    // 动画结束后移除动画类
    setTimeout(() => {
        toc.classList.remove('animating');
        content.classList.remove('animating');
    }, 300);
});